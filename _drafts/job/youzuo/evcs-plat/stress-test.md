---
layout: "post"
title: "stress - test "
date: "2019-05-27 10:40"
---

# 压测

## debug

> [移动端接口性能调优](http://10.28.32.11:8090/pages/viewpage.action?pageId=819518)

### 场站详情接口

#### review 接口代码发现的问题

1. 场站基本信息查询使用了一个查（ site 表 **左联多张表** 的 sql，实际接口中不需要使用到其部分数据）
2. 场站图片与场站服务电话的错误与 **重复查询** （场站服务电话先获取了场站管理员的加密电话后再 **解密**，现服务电话已迁移到另一张表并明文存储）
3. 当前价格数据 **重复获取** - assembleSiteDto 方法（后面的电价数据在 web 层用于格式化数据， service 层可简化）
4. assembleSite 方法中枪数量数据的获取在场站 维护 状态之前（若场站是维护状态将出现枪状态的），逻辑可优化

|问题原因|解决方案|优化后性能指标|备注|
|::|::|::|::|
|场站基本信息查询使用了一个查（ site 表 **左联多张表** 的 sql，实际接口中不需要使用到其部分数据）|重写此处查询，只查询需要的数据|   |   |
|场站图片与场站服务电话的错误与 **重复查询** （场站服务电话先获取了场站管理员的加密电话后再 **解密**，现服务电话已迁移到另一张表并明文存储）|优化代码，直接查询明文电话|   |   |
|当前价格数据 **重复获取** - assembleSiteDto 方法（后面的电价数据在 web 层用于格式化数据， service 层可简化）|优化价格数据逻辑|   |   |
|assembleSite 方法中枪数量数据的获取在场站 维护 状态之前（若场站是维护状态将出现枪状态的无效查询），逻辑可优化|优化场站/电枪状态数据获取的逻辑|||


测试场站详情 service 方法
- 200 个线程跑
  - 老 service 最快 1326， 最慢 4574
  - 新 service 最快 1662， 最慢 3257
