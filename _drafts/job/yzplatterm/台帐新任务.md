---
title: "台帐新任务"
date: "2017-12-01 11:39"
---



# 负责API

## 注意事项

- 做API同学们， 请注意， 我们的任何查询操作， 不要关联到account表
- 和司机或者员工相关的查询或者操作， 关联到staff表

## 司机

- 3.1.2. 司机基本信息表  2               天金   杨川
- 3.1.3. 司机基本信息统计表  1         天金， 杨川
- 3.1.4. 企业人员变动汇总表   2       天金， 杨川
- 3.1.5. 交通违法的数据录入与处理  3    excel导入： 黄浩， 陈涛, APP:?
- 3.1.6. **交通违法汇总表**  3            需要ddl,  越川， 康珊 3天
- 3.1.7. **交通违法记录表**  3            [打印相关]越川， 康珊 3天
- 3.1.8. **交通违法处罚表**  3           [WEB.录入]   [APP.H5]    越川， 康珊 3天
- 3.1.9. **安全教育记录表**  4           待梳理流程   越川， 康珊 4天
  - 删除功能不做 `物理删除` ，要在这个数据中加入一个视图不可读取的字段吗？
- 3.1.10. **安全教育签到表**  4          待梳理流程   越川， 康珊 4天

## 机动车

- 3.2.2. [维护]**日常维护表**  2              王刚， api: 康珊 2天， web端查看， 越川 NO.1
  - 行程进行中，结束排班，这种情况下，强制弹出收车检查（这个时候没有结束行程这个选项）
  - 移动端是否可以判断有不通过项就提示填写备注
  - 有不通过项需要重新排班还是取消重排车辆，这个排班取消，这条检查记录还存在
    - 如果只是修改这个排班，且要保证这条检查的记录还存在，那么只用 排班id 作为外键是不够的。还需要另加一个废弃字段表明此条记录是否废弃，同时还得把车牌号信息给出来（要么直接用车牌号，要么加上车辆id）
  - 一对多插入表中时，先插入主表，再取插入后生成的 id ，并将这个 id 放到多个从表数据记录中插入，什么方法更先进地实现？
  - 当有不通过项，线下联系删除排班并重新排班，这条不通过项的记录还是一样要记录下来嘛？
  - 前端传来哪种类型的检查提交，后端来处理数据，包括了签名这个对象只使用一个字符串就行了
- 3.2.3. [维护]**二级维护表** 维护保养检测内容维护  2    web端: 智豪, h5前端： 智豪， api: 康珊 2天
- 3.2.4. [车辆信息]**车辆基本信息登记** 2.5       web端: 智豪, h5前端： 智豪， api: 康珊 3天

### 日常维护表
[之前的 pc 端原型图][c384d709]
- [DDL]
  - 数据库表设计
    - 日期，统一使用排班的日期
    - 与排班表一对一关联（日期、车牌号从排班表中获取）
    - 签名分两次：行车前与收车，则签名字段需要有两个

#### 红玉问题

刚和你讨论的是违章的日常检查项的获取方式。目前是按照枚举的family获取对应的枚举组。默认是否通过扩展性太低并且没有考虑到多企业日常检查项不一致的情况，建议是每一个日常检查项都有是否默认通过、名称、id。客户端根据后端数据来显示是否默认通过、对应的检查项。



#### 功能

- [x] 单条检查记录保存
- [ ] 单条检查记录详情的查询
- [ ] 根据日期查询，分页显示记录基本信息（总条数）


#### 遗留问题

在后期可能会需要现在来填的坑：
- [x] 现在默认写的是排班与日常检查记录是一对一关联的，写的通过排班id查找检查记录，如果后期增加情况出现一个排班多个检查记录的情况，那么这个方法明显会导致错误；




### 车辆登记表

新加的字段：管辖区县、燃油种类、功耗的表要新建？还是直接加字段？

#### questions

建表中，图片地址 varchar(255) `二进位` 是否勾选
`字符集` 选择？


[c384d709]: https://pro.modao.cc/app/F7FwnNl1kiXixZeJvWcqYzPaEN1TjfX#screen=s79E66B46111500371972537 "pc 端操作原型图"

### 二级维护表

#### 功能

- 新增一个二级维护记录 save
- 删除
- 查找
- 修改




- 3.2.5. [车辆信息]车辆基本信息统计 1                  web端: 智豪, 杨川
- 3.2.6. [车辆信息]车辆变动情况汇总表 1               web端： 越川， 杨川
- 3.2.7. [交通事故]交通事故汇总表  3                    web端： 杨川， api: 天金
- 3.2.8. [交通事故]交通事故记录表  3                    web端： 杨川， api: 天金
- 3.2.9. [交通事故]交通事故教育表 4                     web端： 杨川， api: 天金
- 3.2.10. [安全排查]安全隐患排查汇总表  3            [pad.h5]   [查询+打印] 黄浩，天金
- 3.2.11. [安全排查]安全隐患排查表  3                   黄浩，天金
- 3.2.12 [油耗报表]包车企业燃油消耗情况月报


- 字段有：
    - 记录类型，分为：一级维护、二级维护、春运临检、车辆年检、二维检测+等级评定、等级评定共6种
    - 开始时间，精确到分
    - 结束时间，精确到分
    - 实施内容，必填
    - 实施单位
    - 合格证/报告编号
    - 检测/评定结果，选填
    - 累计里程，选填
    - 费用
    - 备注
- [TODO][APP-H5] 需要录入

## 2017-12-与陈域微信确认安全教育表对话内容

- 游茜:
  - 这个是创建一次安全教育的界面，
  - 里面会录入主题、宣讲人、企业等信息，
  - 下面是选择参加安全教育的人的姓名
- 游茜:
  - 保存之后可以打印签到表
- 陈域:
  - 相当于从企业整体的员工名册中选人对吗
- 游茜:
  - 这个地方咱们确认下， 选择司机名册的司机还是所有员工里选择呢？
- 陈域:
  - 所有员工里选
- 游茜:
  - 好的， 这里我们几下了先
- 游茜:
  - 然后我继续说哈，
- 陈涛:
  - 包括人事财务这些都可以选？
- 陈域:
  - 对的
- 陈涛:
  - 好的
- 陈域:
  - 人事，财务，都有安全责任的
- 陈涛:
  - 目前台账里面是只有这几个角色，是否要增加人事财务等角色？
- 陈涛:
  - 还是归到其他人员里面？
- 游茜:
  - 这个报表之前我们貌似没看到过
- 陈域:
  - 归到管理人员里面
- 陈域:
  - 其他人员是外部来宾
- 游茜:
  - ok， 外部来宾会出现在我们签到表里呢？
- 陈域:
  - 会的，主要是交警、运管和其他一些行业官员
- 游茜:
  - 那这一部分我们需要手动录入了， 不能从我们系统里选择了喔？
- 陈域:
  - 对的
- 游茜:
  - 好的
- 陈域:
  - 可以录在，主讲人那里
- 陈涛:
  - 这个宣讲人可以有多个？
- 陈域:
  - 可以
- 陈涛:
  - 签到完成后需要你们手动将数据录入到系统里面
- 陈涛:
  - 这个行不？
- 陈域:
  - 可以
- 陈涛:
  - 这儿是不是要增加一个其他人员的录入？比如交警、运管不在我么你系统里面，这个签到表录到系统里面就需要新增人员
- 陈域:
  - 可要可不要，因为他们来了的话，鸠占鹊巢，算主讲人
- 陈涛:
  - 好
- 陈涛:
  - 那个补课签到，是不是要把补课的人员标记出来？
- 陈域:
  - 要的
- 陈域:
  - 补课的要区分出来
- 陈涛:
  - 补课的时候应到人数是第一次没来的人数吧？
- 陈域:
  - 应到人数是公司全体人数
- 陈域:
  - 或者是各部门全体人数

## 2017-12-26 会议讨论相关

### 问题

1. 交违法录入到汇总，这个数据有来源，怎么更改？在汇总表直接改还是从记录表中改？需要对接来自交管部门数据？
2. 安全教育表
  1. 外来人员的录入
  2. 签到表需要放入台帐系统吗？需要打印吗？
3. 日常检查
  1. 没通过不跑的排班的检查记录需要添加到系统吗？

### 结论

1. 车辆二级维护表不需要打印
2.HI， 大家， 这是中午和陈域沟通后的会议纪要和结论， 请照结论跟进设计哈，

### 3.1.6. 交通违法汇总表
#### 3.1.6.1 次帐信息
不需要次帐(记录在台账中)， 台账内允许修改(只能修改备注， 需要确认-陈域， 其他的需要修改么？)
陈域： OK其他数据暂时不需修改

### 3.2.2. [维护]日常维护表
基于排班来过滤。
需要确认-陈域， 收车后检查，是否每次排班结束都记录， 因为收车后是否下次排班是否取消不可预期。
陈域： OK， 收车后检查（不过注意： 一天可以只有一次）
杨川： 当天第一次排班做发车前、行车中、收车后检查。（按照人和车组合判定）

### 3.2.5. 车辆信息.车辆基本信息统计
#### 3.2.5.1 次帐信息
次帐仅白名单， 台账内不做修改 ~~需要次帐， 台账内允许修改~~
陈域: OK，
信息会在有座系统里面修改后反应到台账报表中来

### 3.2.7. 交通事故-交通事故汇总表
#### 3.2.7.1 次帐信息
不需要次帐， 台账内允许修改

备注： (需要确认-陈域， 明天确认下这个方案是否ok)台账允许修改的内容在 **3.2.8交通事故记录表** 中修改， 本表仅做统计后结果， 数据在3.2.8中修改后， 需要重跑job刷新数据。
陈域： OK，修改后自动刷新到报表。

### 3.2.10. [安全排查]安全隐患排查汇总表
#### 3.2.10.2 原型
- [安全隐患排查汇总表原型地址(含修改)](https://pro.modao.cc/app/54hzFvnPah44LlWtNtKdriYzKH891Kv#screen=sA2680A8DF81514278499595)
需要确认-陈域， 汇总表和记录表可能不一致， 是否考虑**交通事故汇总表** 类似方案， 修改记录后刷新汇总表？
陈域： OK， 修改后自动刷新到报表

### 3.2.12. 包车企业燃油消耗情况月报
#### 3.2.12.1 次帐信息
需要次帐， 台账内允许修改 (需要确认-陈域， 这个是否需要次帐？)
陈域： 建议做真实数据， 修改后打印， 杨川： 我们做2份数据， 一份真实的， 一份打印

### 3.1.10. 安全教育签到表

需要确认-陈涛， TODO: 明天我们确认一下打印台账时， 是否需要打印签到表。
陈域：  我们会保留原始带墨迹司机签字的的文档， 另外拍照上传的照片作为存档， 台账报表的时候不再打印了。
